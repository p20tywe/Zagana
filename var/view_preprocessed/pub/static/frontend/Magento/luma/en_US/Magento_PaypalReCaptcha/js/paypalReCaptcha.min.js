define(['MSP_ReCaptcha/js/reCaptcha','jquery','MSP_ReCaptcha/js/registry'],function(Component,$,registry){'use strict';return Component.extend({reCaptchaCallback:function(token){this.tokenField.value=token;this.$parentForm.trigger('captcha:endExecute');},initCaptcha:function(){var me=this,$parentForm,$wrapper,$reCaptcha,widgetId;if(this.captchaInitialized){return;}
this.captchaInitialized=true;$wrapper=$('#'+this.getReCaptchaId()+'-wrapper');$reCaptcha=$wrapper.find('.g-recaptcha');$reCaptcha.attr('id',this.getReCaptchaId());$parentForm=$wrapper.parents('form');widgetId=grecaptcha.render(this.getReCaptchaId(),{'sitekey':this.settings.siteKey,'theme':this.settings.theme,'size':this.settings.size,'badge':this.badge?this.badge:this.settings.badge,'callback':function(token){me.reCaptchaCallback(token);me.validateReCaptcha(true);},'expired-callback':function(){me.validateReCaptcha(false);}});$parentForm.on('captcha:startExecute',function(event){if(!me.tokenField.value&&me.settings.size==='invisible'){grecaptcha.execute(widgetId);event.preventDefault(event);event.stopImmediatePropagation();}else{me.$parentForm.trigger('captcha:endExecute');}});this.tokenField=$('<input type="text" name="token" style="display: none" />')[0];this.$parentForm=$parentForm;$parentForm.append(this.tokenField);registry.ids.push(this.getReCaptchaId());registry.captchaList.push(widgetId);registry.tokenFields.push(this.tokenField);}});});